### 事件循环

事件循环的概念不再赘述, 这里主要说一下 rAF, rIC 在时间循环中的角色, 还有它们和 setTImeout 一起使用时的优先级问题

### 几个关键的新知识点和错误的刻板认知

1. **wrong**, 宏任务执行期间, 一定会伴随着渲染(一帧的绘制)
   实际情况是: 不一定

```js
setTimeout(() => {
  document.body.style.background = 'red';
  setTimeout(() => {
    document.body.style.background = 'blue';
  });
});
// 上面的代码, 最两个宏任务之间修改页面的背景颜色, 想要先变红, 再变烂
// 实际上, 这个结果是不可控的, 如果这两个 Task 之间正好遇到了浏览器认定的渲染机会, 那么它会重绘, 否则就不会. 由于这俩宏任务的间隔周期太短了, 所以很大概率是不会的
```

2. **new**, 定时器宏任务可能会直接跳过渲染, 也可能会合并两个定时器任务

```js
setTimeout(() => {
  console.log('sto');
  requestAnimationFrame(() => console.log('rAF'));
});
setTimeout(() => {
  console.log('sto');
  requestAnimationFrame(() => console.log('rAF'));
});

queueMicrotask(() => console.log('mic'));
queueMicrotask(() => console.log('mic'));

// 上面的两个定时任务, 会被合并
```

3. setTimeout, rAF, rIC

他们同时出现时, 执行顺序往往不是一定的
需要掌握它们各自的特点,

setTimeout 生成一次宏任务, 对应一次事件循环, 多个事件循环之间不一定执行 rAF, rIC 一定是某一帧存在空闲时才执行, 若主线程一直忙碌, 可能一直不会执行, 也可以通过设置 timeout 来强制执行 rIC 回调

4. 一些结论

rAF 一定伴随着一帧的绘制
rAF, rIC 和事件循环没有强关联

### 参考资料

https://segmentfault.com/a/1190000019154514

https://zhuanlan.zhihu.com/p/142742003

https://segmentfault.com/a/1190000008589736

https://zhuanlan.zhihu.com/p/25407758

https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/
