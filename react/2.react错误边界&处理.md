## 错误边界

### 官方

- 先上官方提供的解决办法: [传送门](https://zh-hans.reactjs.org/docs/error-boundaries.html)

- 具体是，在外层定义一个错误包裹组件，用于收集子元素的所有错误，当捕获到 error 时，降级渲染备用 UI(若提供)

- 这个错误包裹组件没有什么特殊的，也是集成自 `React.Component`，主要看这两个方法：`getDerivedStateFromError`，`componentDidCatch`，只要一个 class 组件使用了其中任意一个，那么它就是一个错误边界

### 实践

- 主要是使用粒度，想在哪一个层面提前暴露出错误，希望哪些组件可以不受影响等等，这个视情况而定，一般我的做法是，在页面的不同区域，组织多个边界来处理各自的错误

- 如果每个组件都需要，手动添加非常麻烦，后期如果要改动，也是很大的工作量，通常这种全局工作，可以用 webpack 插件做，babel 读到是 JSX 就给 return 包裹一个错误边界，或者可以使用装饰器来做，效果差不多

- 对于 SSR，官方的错误边界并没有支持，这里可以通过代理原始 render 的方式实现，在新的 render 内部加入 `try-catch` 逻辑，然后照常输出原始内容

### 问题

- 和 try catch 有什么联系吗

`try-catch` 是命令式的，而错误边界是声明式的，而且他们处理错误范围也不同，具体看下一个问题

```js
try {
  showButton();
} catch (error) {
  // ...
}

<Button />;
```

- 他的使用范围?为什么?

错误边界的初衷是用来捕获渲染期间的错误，不能捕获事件处理器内部的错误，因为事件处理不会在渲染期间触发

### TODO

- 他是如何做到被上抛的?

### 参考资料

[传送门](https://juejin.cn/post/6844904047313420295)
