### TODO

##### tcp 序列号, 确认号

一个 tcp 连接中所传送的字节流中的**每一个字节都会按顺序编号**, 整个要发送的字节流的起始序号必须在建立连接时设置
tcp 头部的序号指的是**本报文段(这个 tcp 所发送的数据)**所发送的数据的第一个字节的序号

tcp 头部的确认号指的是**期望对方下一个报文段的第一个数据字节的序号**

##### 队头阻塞

tcp 的对头阻塞, 缓存区内的数据没有按需收到, 例如, 本来应该顺序接收 1,2,3,4,5, 但是缺接收到 1,3,4,5, 那么 3,4,5 这三个数据包不会被使用, 而是要等待发送端重发 2 才行

##### 网络安全

### 路由转发的流程:

1. 从数据包首部提取目标 IP 地址 D, 网络地址 N
2. 如果 D/N 是直接相连的, 直接发送数据
3. 路由表中是否有 D 的记录, 有就发送到对应的下一跳路由, 否则
4. 路由表中是否有 N 的记录, 有就发送到对应的下一跳路由, 否则
5. 路由表中是否有 默认路由, 有就发送给默认路由, 否则
6. 报错

每一次路由寻址并不会知道完整的路由路线, 只是在每一跳中重复以上过程

### TCP 的特点

1. 面向连接 - 必须要先建立 TCP 连接
2. 每一个 TCP 只能有两个端点 - 他们是 **(源 ip + 源 port), (目标 ip + 目标 port)**
3. 可靠的 - ip 协议并不可靠
4. 全双工
5. 面向字节流

### TCP 报文头部

最小 20 字节, 可以 4n 动态扩展, 最大为 60 字节, 具体分布看 **计网: P203-P224**

报文段往返事件 RTT, 超时重传时间 RTO, RTO 应略大于 RTT, 有响应算法可以保证: 使用正确有效的事件来计算 RTT 和 RTO **计网: P226**

### 滑动窗口

滑动窗口用来维持发送端和接收端的 收发速率平衡, 窗口大小是不断动态变化的(通过 tcp 头部确认号), 是做流量控制的

### 拥塞避免

tcp 进行拥塞控制的算法有四种:
慢开始 - 从 1 指数增长, 慢并不是指增长率低, 而是相比于一开始就把所有数据发送出去而言, 慢一些
拥塞避免 - 窗口达到预设值, 开始平稳增加窗口大小
快重传 - 接收端对收到的包进行快速响应, 发送端连续 3 次收到重读确认, 直接重发这个包, 而不用等到超时导致重发(这种情况会导致重新启动慢开始算法)
快恢复 - 快重传情况下, 断定网络状况良好, cwnd 和 ssthresh 均降一半, 然后启动拥塞避免, 而非直接慢启动

### TCP 确认号

**计网: P243**
含义是, 期待收到对方发送的下一个报文段的第一个数据字节的序号, 若确认号为 N, 则表示, 到序号 N-1 为止, 前面所有的字节数据已全部收到

### TCP 窗口

**计网: P243**
含义是, 允许对方发送的数据量, 窗口值是经常动态变化的, 为 0, 表示接收端缓存已满, 无法继续接受, 暂停发送

tips: 这里注意, 窗口值只要变为 0, 发送端会启动一个计时器, 用于周期的向接收端发送试探包, 不携带数据, 不消耗序号, 这是为了防止, 接收端变更窗口的包(缓存消费完, 新的窗口位置被释放出来, 通知发送端可以扩大窗口值, 继续发送)丢失的, 造成发送端持续无意义等待

### 为什么是 3 次握手

**计网: P239**
两次握手后, 实际上建立已经连接, 客户端(发起 tcp 请求的称为客户端)最后一次确认是为了防止 **已失效的**连接请求报文突然传到服务端造成错误

什么是 失效的连接请求?

客户端发送一个连接请求, 但是因为种种原因没有按时到达服务端而是滞留在网络节点中, 客户端在达到超时时间后仍然没有收到响应确认, 判断为超时, 重发一个连接请求(这时, 上一个请求理论上就是一个失效请求), 中间经过一段时间, 这个滞留的请求到达服务端, 服务端会误以为这个客户端发送的一个新的连接请求, 假如没有第三次确认, 那么这时服务端不需要经过客户端确认就可以直接建立连接, 造成了网络资源的浪费
